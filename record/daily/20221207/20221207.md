
Daily Record 20221207
=====================

## 流水

实验指导书；

## 知识点

##### inline assembler

An [inline assembler](https://en.wikipedia.org/wiki/Inline_assembler) is a feature of some compilers that allows low-level code written in assembly language to be embedded within a program, among code that otherwise has been compiled from a higher-level language such as C or Ada.

##### inline assembly

The idea behind [inline assembly](https://wiki.osdev.org/Inline_Assembly) is to embed assembler instruction in your C/C++ code.

##### inline assembly by `asm!` or `global_ams!`

[Rust](https://doc.rust-lang.org/nightly/rust-by-example/unsafe/asm.html) provides support for inline assembly via the `asm!` macro.

[It can be used](https://doc.rust-lang.org/nightly/reference/inline-assembly.html) to embed handwritten assembly in the assembly output generated by the compiler.

All `asm!` invocations have to be inside an `unsafe` block.

`asm!` in a function scope;

`global_asm!` in a global scope, outside a function.

##### 全局中断使能

《[Difference](https://forum.allaboutcircuits.com/threads/difference-between-global-interrupt-enable-and-peripheral-interrupt-enable-bit.166766/) between Global Interrupt Enable and Peripheral Interrupt Enable bit》

《[Interrupts](https://picguides.com/beginner/interrupts.php)》

The code that is run when an interrupt occurs is called an **Interrupt Service Routine** (ISR).

如果disable，单核情况下，可以作为一种同步机制，关闭之后控制流就会独占计算资源不会被打断，从而原子的生效，和引起调度的锁用法类似。

##### csrrw

状态控制寄存器指令

##### rs: register source

##### rd: register destination

##### `.rept count` 汇编指令

assembler directives, often called pseudo-ops

##### 通过换栈实现控制流的切换

##### 栈帧StackFrame

一个函数所使用的的栈的一部分区域，函数所有的栈帧串起来就组成了一个完整的栈

##### 表示栈

实现的时候需要维护一个指向栈顶的指针来表示栈当前的状态；

##### 寄存器主要是用来放地址的，意义是在程序员脑海中编排出来的

##### `.S` vs `.asm`

They are [different versions](https://stackoverflow.com/questions/34098596/assembly-files-difference-between-a-s-asm) of asm syntax.

**`.s`** is used for asm compiler output, `gcc -S foo.c` produces asm output, with a default filename of `foo.s`.

**`.S`** is used for hand-written asm source files. `gcc -c foo.S` runs it through the C preprocessor; for asm in GUN `as` syntax;

There are two separate versions of asm syntax: **AT&T** (used by Unix compiler like gcc), **Intel/NASM** (with a couple dialects, like MASM, NASM)

In x86, `.asm` is more often associated with Intel-syntax NASM/YASM source code;

Outside of x86, it's probably a good choice for asm source files that could be assembled by the platform-specific assembler, if it uses different directives than GNU `as`.

##### 忙等

CPU发出I/O请求之后，由于CPU运算速度快于外设，导致CPU需要等待请求处理完毕并拿到完整的处理结果之后才能继续。

外设会提供一个可读的寄存器记录它当前的工作状态，CPU不断的循环读取直到它的结果显示设备已经将请求处理完毕了，才能继续后续执行。

##### `#[derive]`

通过其可以让编译器为定义的类型提供一些Trait的默认实现；

##### 编程风格：变量与常量分离

##### 后台应用 vs 交互式应用

后台应用，协作式；只要应用不主动yield交出CPU使用权，它就会一直执行下去；

交互式应用，体验，抢占式；应用随时都有被内核切换出去的可能；

##### 时间片Time Slice： 在毫秒量级

##### 调度算法： 时间片轮转算法 Round-Robin

每次在患处之前给一个应用多少时间片去执行；

要还如哪个应用；

从性能（吞吐量，延迟）和公平性两个维度来评价；

Round-Robin: 每次从队头取一个应用执行一个时间片，然后把它丢到队尾，再循环继续，直到所有应用都执行完毕；

##### 时钟中断

操作系统的**计时功能**是依靠硬件提供的**时钟中断**来实现的；

##### 内置时钟，计数器

内置时钟频率一般低于CPU主频；

还有一个计数器（mtime）用来统计处理器自上电以来经过了多少个内置时钟的时钟周期；

##### 内存映射寄存器memory mapped register

[A crucially important link](https://schaumont.dyn.wpi.edu/ece4530f19/lectures/lecture06-notes.html) between the world of hardware and software.

It's a hardware register, typically as wide as the data word-width in the system.

The register is directly accessible from software because it is mapped into a memory location of the memory-map.

[Difference](https://superuser.com/questions/695475/whats-the-difference-between-a-hardware-register-and-a-memory-mapped-register) between hardware register and a memory-mapped register?

##### Register vs. Memory

The register holds the data that the CPU is currently processing [whereas](https://www.quora.com/What-is-the-difference-between-register-and-memory), the memory holds the data that will be required for processing.

[Registers](https://www.geeksforgeeks.org/difference-between-register-and-memory/) are the smallest data holding elements that are built into the processor itself. These are the memory locations that are directly accessible by the processor. It may hold an **instruction**, a **storage address** or any kind of data such as a bit sequence or individual characters.

##### 中断 Interrupt

与异常一样都是一种Trap；

**异常**与当前CPU的指令执行是**同步**的Synchronous，异常的触发原因一定可以追溯到某条执行的执行；

**中断**是**异步**于当前正在进行的指令，中断来自于哪个外设以及中断如何触发完全与处理器正在执行的当前指令无关；

异常出现在处理器内部电路，中断是与处理器执行指令无关的电路发起的；这套电路仅通过一根导线接入处理器，当外设想要触发中断的时候则输入一个高电平或正边沿，处理器会在每执行完一条执行之后检查下这根线，看情况决定是继续执行接下来的指令还是进入中断处理流程；

##### 中断

1. Software Interrupt
2. Timer Interrupt
3. External Interrupt



## 总结



## 下次学习入口



##### [返回Home](../../../README.md)


