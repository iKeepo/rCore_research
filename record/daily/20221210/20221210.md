
Daily Record 20221210
=====================

## 流水

实验指导书；

## 知识点

##### 内存分页管理

内核以页为单位进行物理内存管理。

每个应用的地址空间可以被分成若干个（虚拟）页面（Page）；

可用的物理内存也同样被分成若干个（物理）页帧（Frame）；

Page和Frame的大小相同；

每个Page上的数据实际上都存储在某个Frame上；

与**分段内存管理**相比，**分页内存管理**的粒度更小且大小固定；

分页内存管理**每个Page**在地址转换过程中都使用与运行的应用绑定的**不同**的线性映射；不像分段内存管理那样每个逻辑段都使用同一个线性映射；

应用地址空间中的<u>每个逻辑段</u>都由<u>多个Page</u>组成；

每个**Page**有一个编号**虚拟页号**（**VPN**，Virtual Page Number）；

每个**Frame**有一个编号**物理页号**（**PPN**，Physical Page Number）;

每个**应用**都有一个表示地址映射关系的**页表**（Page Table）；记录每个Page映射到哪个Frame；

**页表项**（Page-Table Entry， **PTE**）；

PageTable中还针对虚拟页号设置了一组保护位：

- r: 当前应用可以读该内存
- w: 当前应用可以写该内存
- x: 当前应用可以从该内存取执行来执行

##### MMU：默认情况下未启用

MMU未启用，无论CPU位于哪个特权级，访存的地址都会作为一个物理地址交给对应的的内存控制单元来直接访问物理内存；

MMU进行地址转换的时候，虚拟地址会分为两部分：虚拟页号，页内偏移；

地址转换是以页为单位进行的，在地址转换的前后，地址的页内偏移部分不变；

##### satp寄存器（Supervisor Address Translation and Protection）

##### SvX: 分页方案的命令，X表示以位为单位的虚拟地址的长度

**Sv32**的页表是基数为$2^{10}$的两级树结构。**PageTable**中每个项的大小是四个字节，因此PageTable本身的大小是4Kb。

##### Sv39

基页4Kb；4Kb需要12位字节地址来表示，即虚拟（物理）地址的低12位表示**页内偏移**（**Page Offset**）；

页表项8Kb；

基数$2^9$,这样页表可以与页面大小一致；树分为3层：$2^9$个1Gb的吉页，每个吉页有$2^9$个巨页，每个巨页有$2^9$个基页；

PPN44位（物理页号），加上虚拟地址后12位作为页偏移，表示56位的物理地址；

39是虚拟内存的位数，可以表示512GB虚拟内存，对应56位物理地址；

##### 地址转换的核心任务

维护虚拟页号到物理页号的映射，即**页表**；

##### MMU中的TLB（Translation Lookaside Buffer）

利用时间局部性和空间局部性；

## 总结



## 下次学习入口



##### [返回Home](../../../README.md)


